
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Capturing Screencasts on Ubuntu using `ffmpeg` - Software, Physics, Data, Mountains</title>
  <meta name="author" content="Mark M Mims, Ph.D.">

  
  <meta name="description" content="In this post I describe the capture setup we used to create screencasts using
an Ubuntu Linux desktop. This one just describes the recording process &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://markmims.com/mids/ubuntu/2020/07/29/screencasts-with-ffmpeg.html">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Software, Physics, Data, Mountains" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Ubuntu:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Ubuntu:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4132881-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Software, Physics, Data, Mountains</a></h1>
  
    <h2>...and other random associations</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:markmims.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about.html">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Capturing Screencasts on Ubuntu Using `ffmpeg`</h1>
    
    
      <p class="meta">
        








  


<time datetime="2020-07-29T00:00:00+00:00" pubdate data-updated="true">Jul 29<span>th</span>, 2020</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In this post I describe the capture setup we used to create screencasts using
an Ubuntu Linux desktop. This one just describes the recording process itself.
I&#8217;ll go over the overall screencast development process and editing in separate
posts.</p>

<!--more-->

<h2 id="contents">Contents</h2>

<ul>
  <li>Overview</li>
  <li>Desktop</li>
  <li>Slides</li>
  <li>Terminal</li>
  <li>Camera</li>
  <li>Audio</li>
  <li>Putting it all together</li>
</ul>

<h2 id="overview">Overview</h2>

<p>These scripts were created to record screencasts for a class on Data
Engineering, so they&#8217;ll need to cover both high-level conceptual material as
well as detailed examples or tutorials.</p>

<p>To do that we really wanted to have the flexibility of showing both slides as
well as terminal or web interactions at the same time. We also figured it&#8217;s a
good idea to have the ability to overlay a talking head when there&#8217;s not much
other detailed interaction going on, so we also wanted to be sure we captured
camera footage during the recordings as well.</p>

<p>This setup is designed to capture raw footage of all of those channels at once.
We looked around, but couldn&#8217;t find any off-the-shelf tools that really met our
needs for this.  It turns out this is actually pretty easy to accomplish just
using <code>ffmpeg</code> directly from a script.</p>

<h2 id="desktop">Desktop</h2>

<p>Note the desktop setup:</p>

<ul>
  <li>
    <p>Ubuntu desktop with three monitors set up within a single X session.  You&#8217;ll
want at least two to capture both slides and terminal/web at once</p>
  </li>
  <li>
    <p>Each desktop is <code>1920x1080</code>, so the total big desktop size is <code>3x1920</code> pixels
wide and 1080 pixels tall</p>
  </li>
  <li>
    <p>Terminals/Browsers run on the left-hand monitor</p>
  </li>
  <li>
    <p>Slides are full-screen on the center monitor</p>
  </li>
  <li>
    <p>Webcam lives on top of the left monitor so we&#8217;re looking roughly towards the
camera when going through a detailed example</p>
  </li>
  <li>
    <p>Sound is coming from a lavalier mic plugged into a USB audio interface made
available via standard Linux alsa devices</p>
  </li>
  <li>
    <p>I use the right-hand monitor to hold terminal windows to start/stop these scripts,
but nothing from there is recorded</p>
  </li>
</ul>

<p>Below, we&#8217;ll go through each of the different capture channels used 
and then wrap it all up with a bow into a single script that follows
the <code>screencasts -&gt; shots -&gt; takes</code> file organization that we used to keep
track of all of this.</p>

<h2 id="slides">Slides</h2>

<p>To capture a stream of slides, we&#8217;re using the <code>x11grab</code> ffmpeg interface. This
is designed to just sample what the X server sees every so often (<code>$framerate</code>)
and then encode and save that as a video stream.</p>

<p>The tricky part is creating a command to record the correct monitor for slides.
Since the middle monitor is running slides, we tell <code>ffmpeg</code> to capture a
single monitor&#8217;s <code>1920x1080</code> worth of screen but <em>start</em> that from the geometry
offset <code>+1920,0</code>&#8230; the top of the middle monitor.</p>

<p>The command </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">ffmpeg <span class="se">\</span>
</span><span class="line">  -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">  -f x11grab -r <span class="nv">$framerate</span> -s hd1080 -i :0.0+1920,0 <span class="se">\</span>
</span><span class="line">  -vcodec libx264 <span class="se">\</span>
</span><span class="line">  -preset ultrafast <span class="se">\</span>
</span><span class="line">  <span class="nv">$output_dir</span>/slides.mkv &gt; <span class="nv">$output_dir</span>/slides.log 2&gt;&amp;1
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>gets wrapped in a bash function to capture slides:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">capture_slides<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f x11grab -r <span class="nv">$framerate</span> -s hd1080 -i :0.0+1920,0 <span class="se">\</span>
</span><span class="line">    -vcodec libx264 <span class="se">\</span>
</span><span class="line">    -preset ultrafast <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/slides.mkv &gt; <span class="nv">$output_dir</span>/slides.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;slides done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This saves to the files <code>slides.mkv</code> and <code>slides.log</code>.</p>

<h2 id="terminal">Terminal</h2>

<p>We&#8217;ll use <code>x11grab</code> to record the left-hand monitor as well. The offset here is
just the top of the left-hand monitor, so <code>+0,0</code> in X geometry speak:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">capture_terminal<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f x11grab -r <span class="nv">$framerate</span> -s hd1080 -i :0.0+0,0 <span class="se">\</span>
</span><span class="line">    -vcodec libx264 <span class="se">\</span>
</span><span class="line">    -preset ultrafast <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/terminal.mkv &gt; <span class="nv">$output_dir</span>/terminal.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;terminal done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This saves to the files <code>terminal.mkv</code> and <code>terminal.log</code>.</p>

<h2 id="camera">Camera</h2>

<p>To capture the stream from the webcam, we&#8217;re relying heavily on the fact that
the 
<a href="https://www.amazon.com/gp/product/B006JH8T3S/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">Logitech HD Pro Webcam C920</a>
does hardware h264 encoding on the fly and we&#8217;re just tapping into that using
ffmpeg&#8217;s <code>v4l2</code> interface to simply <code>copy</code> the video stream out to a file.</p>

<p>I also had some problems understanding the timestamps that the camera&#8217;s
hardware encoder used, so I include the set of <code>ffmpeg</code> args that fixed that.
YMMV depending on your camera.</p>

<p>Probably the most important thing to recognize is that the capture relied on
the hardware encoding.  If we were getting raw video and having to encode on
the fly, then the desktop&#8217;s computational capabilities my come more into play.
This usually results is limiting the framerate you can actually record.</p>

<p>Here&#8217;s the function to capture the camera footage:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">capture_webcam<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f v4l2 -framerate <span class="nv">$framerate</span> -input_format h264 -video_size hd1080 -ts mono2abs -i /dev/video0 <span class="se">\</span>
</span><span class="line">    -c copy -copyts -start_at_zero <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/webcam.mkv &gt; <span class="nv">$output_dir</span>/webcam.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;webcam done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This saves to <code>webcam.mkv</code> and <code>webcam.log</code>.</p>

<h2 id="audio">Audio</h2>

<p>Audio is coming in through a 
<a href="https://www.amazon.com/gp/product/B00MIXF2RS/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">TASCAM US-2x2</a>
USB-audio interface, where I have a 
<a href="https://www.amazon.com/gp/product/B01GSVQN6Y/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">lavalier mic</a>
plugged in.  This &#8220;just worked&#8221; through the <code>alsa</code> interface for <code>ffmpeg</code> so we
just need to copy the raw audio stream from the device:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">capture_audio<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f alsa -i default <span class="se">\</span>
</span><span class="line">    -c copy -copyts -start_at_zero <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/audio.wav &gt; <span class="nv">$output_dir</span>/audio.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;audio done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>which saves <code>audio.wav</code> and <code>audio.log</code>.</p>

<h2 id="putting-this-all-together">Putting this all together</h2>

<p>So all of the above functions get rolled up into a single script named
<code>capture</code>.</p>

<p>This script kicks off the <code>ffmpeg</code> recordings at roughly the same
time and saves all the output to</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">output_dir</span><span class="o">=</span><span class="s2">&quot;screencasts/${scene_name}/shot-${shot_number}/take-${timestamp}&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>where the variables in there either are defaults (like the shot number) or are
specified as arguments to the script.  I typically use it like</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /opt/screencasts/introducing-spark-streaming
</span><span class="line">capture
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>which kicks off the recording and streams outputs to files such as</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">- shot-010
</span><span class="line">  - take-2018-03-12-165010
</span><span class="line">    - audio.log
</span><span class="line">    - audio.wav
</span><span class="line">    - slides.log
</span><span class="line">    - slides.mkv
</span><span class="line">    - terminal.log
</span><span class="line">    - terminal.mkv
</span><span class="line">    - webcam.log
</span><span class="line">    - webcam.mkv
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This folder structure lets us keep things nice and tidy for editing.</p>

<p>So here&#8217;s the final script:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c">#!/bin/bash</span>
</span><span class="line">
</span><span class="line"><span class="nb">set</span> -o errexit -o nounset -o pipefail
</span><span class="line">
</span><span class="line">usage<span class="o">()</span> <span class="o">{</span>
</span><span class="line">	<span class="nb">echo</span> <span class="s2">&quot;Usage: $0 &lt;scene_name&gt; [&lt;shot_number&gt;]</span>
</span><span class="line"><span class="s2">    where:</span>
</span><span class="line"><span class="s2">      &lt;scene_name&gt; is something like intro-what-is-data-eng</span>
</span><span class="line"><span class="s2">      &lt;shot_number&gt; optional, default is 010&quot;</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line"><span class="o">((</span> <span class="nv">$# </span>&lt; 1 <span class="o">))</span> <span class="o">&amp;&amp;</span> usage <span class="o">&amp;&amp;</span> <span class="nb">exit </span>1
</span><span class="line"><span class="nv">scene_name</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line"><span class="nv">shot_number</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">010</span><span class="k">}</span>
</span><span class="line">
</span><span class="line"><span class="nv">timestamp</span><span class="o">=</span><span class="sb">`</span>date +%Y-%m-%d-%H%M%S<span class="sb">`</span>
</span><span class="line"><span class="nv">output_dir</span><span class="o">=</span><span class="s2">&quot;screencasts/${scene_name}/shot-${shot_number}/take-${timestamp}&quot;</span>
</span><span class="line"><span class="nv">framerate</span><span class="o">=</span>30
</span><span class="line">
</span><span class="line">capture_slides<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f x11grab -r <span class="nv">$framerate</span> -s hd1080 -i :0.0+1920,0 <span class="se">\</span>
</span><span class="line">    -vcodec libx264 <span class="se">\</span>
</span><span class="line">    -preset ultrafast <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/slides.mkv &gt; <span class="nv">$output_dir</span>/slides.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;slides done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">capture_terminal<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f x11grab -r <span class="nv">$framerate</span> -s hd1080 -i :0.0+0,0 <span class="se">\</span>
</span><span class="line">    -vcodec libx264 <span class="se">\</span>
</span><span class="line">    -preset ultrafast <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/terminal.mkv &gt; <span class="nv">$output_dir</span>/terminal.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;terminal done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">capture_audio<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f alsa -i default <span class="se">\</span>
</span><span class="line">    -c copy -copyts -start_at_zero <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/audio.wav &gt; <span class="nv">$output_dir</span>/audio.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;audio done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">capture_webcam<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nb">local </span><span class="nv">output_dir</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="line">  ~/bin/ffmpeg <span class="se">\</span>
</span><span class="line">    -hide_banner -nostats -loglevel warning <span class="se">\</span>
</span><span class="line">    -f v4l2 -framerate <span class="nv">$framerate</span> -input_format h264 -video_size hd1080 -ts mono2abs -i /dev/video0 <span class="se">\</span>
</span><span class="line">    -c copy -copyts -start_at_zero <span class="se">\</span>
</span><span class="line">    <span class="nv">$output_dir</span>/webcam.mkv &gt; <span class="nv">$output_dir</span>/webcam.log 2&gt;&amp;1
</span><span class="line">  <span class="nb">echo</span> <span class="s2">&quot;webcam done&quot;</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="c">##################</span>
</span><span class="line">
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;starting ${scene_name}/shot-${shot_number}/take-${timestamp}&quot;</span>
</span><span class="line">
</span><span class="line">mkdir -p <span class="nv">$output_dir</span>
</span><span class="line">
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;capturing slides&quot;</span>
</span><span class="line">capture_slides <span class="nv">$output_dir</span> &amp;
</span><span class="line">
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;capturing terminal&quot;</span>
</span><span class="line">capture_terminal <span class="nv">$output_dir</span> &amp;
</span><span class="line">
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;capturing webcam&quot;</span>
</span><span class="line">capture_webcam <span class="nv">$output_dir</span> &amp;
</span><span class="line">
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;capturing audio&quot;</span>
</span><span class="line">capture_audio <span class="nv">$output_dir</span> &amp;
</span><span class="line">
</span><span class="line"><span class="k">for </span>job in <span class="sb">`</span><span class="nb">jobs</span> -p<span class="sb">`</span>; <span class="k">do</span>
</span><span class="line"><span class="k">  </span><span class="nb">wait</span> <span class="nv">$job</span>
</span><span class="line"><span class="k">done</span>
</span><span class="line">
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;done&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note that each function is run in the background so they&#8217;re effectively kicked
off in parallel.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Mark M Mims, Ph.D.</span></span>

      








  


<time datetime="2020-07-29T00:00:00+00:00" pubdate data-updated="true">Jul 29<span>th</span>, 2020</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/mids/'>mids</a>, <a class='category' href='/blog/categories/ubuntu/'>ubuntu</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://markmims.com/mids/ubuntu/2020/07/29/screencasts-with-ffmpeg.html" data-via="m_3" data-counturl="http://markmims.com/mids/ubuntu/2020/07/29/screencasts-with-ffmpeg.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/devops/cloud/gcp/iam/2019/06/05/managed-projects-in-gcp.html" title="Previous Post: Projects in GCP using Central Billing Accounts">&laquo; Projects in GCP using Central Billing Accounts</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="comments_note" aria-live="polite"><p>If you have any questions or feedback, please feel free to share it with me on Twitter: <a href="https://twitter.com/m_3">@m_3</a></p>
</div>
  </section>
</div>

<aside class="sidebar">
  
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <section>
    <div id='container'>
      <div id='about-sidebar'>
      </div>
      <br/>
    </div>
    <script type='text/javascript'>
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type='text/javascript'>
      var pageTracker = _gat._getTracker("UA-4132881-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>
  </section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/mids/ubuntu/2020/07/29/screencasts-with-ffmpeg.html">Capturing Screencasts on Ubuntu using `ffmpeg`</a>
      </li>
    
      <li class="post">
        <a href="/devops/cloud/gcp/iam/2019/06/05/managed-projects-in-gcp.html">Projects in GCP using Central Billing Accounts</a>
      </li>
    
      <li class="post">
        <a href="/data-engineering/spark/hadoop/devops/2016/03/17/hwtb-sessions.html">Identifying User Activity from Streams of Raw Events</a>
      </li>
    
      <li class="post">
        <a href="/docker/data-engineering/spark/devops/2015/10/13/docker-cdh.html">Develop Spark Apps on Yarn using Docker</a>
      </li>
    
      <li class="post">
        <a href="/2015/06/01/ssh-tips.html">SSH Tips and Tricks</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2023 - Mark M Mims, Ph.D. -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
